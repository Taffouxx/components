"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Picker=Picker;var _mobx=require("mobx"),_react=_interopRequireWildcard(require("react")),_reactVirtuoso=require("react-virtuoso"),_styledComponents=_interopRequireDefault(require("styled-components")),_closeHook=_interopRequireDefault(require("../../../../lib/closeHook")),_atoms=require("../../atoms"),_EmojiPreview=require("./EmojiPreview");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}const ROW_SIZE=8,Base=(0,_styledComponents.default)(_atoms.Column).withConfig({displayName:"Base",componentId:"sc-1c6g74-0"})(["overflow:hidden;user-select:none;position:absolute;right:10px;bottom:10px;width:calc("," * 40px + 10px + 40px);height:420px;max-width:calc(100vw - 20px);max-height:calc(75vh);background:var(--background);border-radius:var(--border-radius);"],8),Controls=(0,_styledComponents.default)(_atoms.Column).withConfig({displayName:"Controls",componentId:"sc-1c6g74-1"})(["padding:0.5em;"]),Parent=_styledComponents.default.div.withConfig({displayName:"Parent",componentId:"sc-1c6g74-2"})(["flex-grow:1;min-height:0;display:flex;flex-direction:row;"]),Groups=_styledComponents.default.div.withConfig({displayName:"Groups",componentId:"sc-1c6g74-3"})(["width:40px;overflow-y:scroll;scrollbar-width:none;background:var(--secondary-background);border-start-start-radius:var(--border-radius);&::-webkit-scrollbar{width:0px;}"]),EmojiContainer=_styledComponents.default.a.withConfig({displayName:"EmojiContainer",componentId:"sc-1c6g74-4"})(["display:grid;place-items:center;width:40px;height:40px;cursor:pointer;transition:0.1s ease all;border-radius:var(--border-radius);&:hover{background:var(--tertiary-background);}&:active{filter:brightness(0.9);}img{width:28px;height:28px;object-fit:contain;}"]),RowContainer=_styledComponents.default.div.withConfig({displayName:"RowContainer",componentId:"sc-1c6g74-5"})(["display:flex;flex-wrap:wrap;"]),CategoryBar=_styledComponents.default.div.withConfig({displayName:"CategoryBar",componentId:"sc-1c6g74-6"})(["display:flex;align-items:center;background:var(--background);"]),CategoryIcon=_styledComponents.default.div.withConfig({displayName:"CategoryIcon",componentId:"sc-1c6g74-7"})(["display:grid;place-items:center;width:40px;height:40px;user-select:none;pointer-events:none;filter:brightness(0.75);"]),CategoryName=_styledComponents.default.span.withConfig({displayName:"CategoryName",componentId:"sc-1c6g74-8"})(["width:100%;padding:0 0.2em;text-align:left;color:var(--foreground);filter:brightness(0.75);"]);function Picker(a){let{emojis:b,categories:c,renderEmoji:d,onSelect:e,onClose:f}=a;const g=(0,_react.useRef)(null),[h,i]=(0,_react.useState)(""),j=(0,_mobx.observable)({emoji:null}),{items:k,categoryCounts:l,activeCategories:m}=(0,_react.useMemo)(()=>{const a=h.trim().toLowerCase(),d=[],e=[],f=[];for(const h of c){var g;let c=null!==(g=b[h.id])&&void 0!==g?g:[];if(a&&(c=c.filter(b=>b.name?b.name.includes(a):b.id.includes(a)),0===c.length))continue;const i=((a,b)=>{const c=[];for(let d=0;d<a.length;d+=b)c.push(a.slice(d,d+b));return c})(c,ROW_SIZE);d.push(...i),e.push(h),f.push(i.length)}return{items:d,categoryCounts:f,activeCategories:e}},[h,c,b]),n=(0,_react.useMemo)(()=>(0,_react.memo)(a=>{let{index:b}=a;return _react.default.createElement(_react.default.Fragment,null,k[b].map(a=>_react.default.createElement(EmojiContainer,{key:a.id,onClick:b=>{null===e||void 0===e?void 0:e(a.id),b.shiftKey||(null===f||void 0===f?void 0:f())},onMouseOver:()=>j.emoji=a},_react.default.createElement(d,{emoji:a.id}))))}),[k,j,f,e,d]),o=(0,_react.useMemo)(()=>(0,_react.memo)(a=>{let{category:b}=a;return _react.default.createElement(CategoryIcon,null,b.emoji?_react.default.createElement(EmojiContainer,null,_react.default.createElement(d,{emoji:b.emoji})):_react.default.createElement(_atoms.Avatar,{size:24,fallback:b.name,src:b.iconURL}))}),[d]),p=(0,_closeHook.default)(f);return _react.default.createElement(Base,{gap:"0",ref:p},_react.default.createElement(Controls,null,_react.default.createElement(_atoms.InputBox,{autoFocus:!0,value:h,onChange:a=>i(a.currentTarget.value),placeholder:"Type to search..."})),_react.default.createElement(Parent,null,_react.default.createElement(_reactVirtuoso.GroupedVirtuoso,{ref:g,style:{flexGrow:1,padding:"0 2px",overflowX:"hidden"},components:{Item:RowContainer},groupCounts:l,groupContent:a=>{const b=m[a];return _react.default.createElement(CategoryBar,null,_react.default.createElement(o,{category:b}),_react.default.createElement(CategoryName,null,b.name))},itemContent:a=>_react.default.createElement(n,{index:a})}),_react.default.createElement(Groups,null,m.map((a,b)=>_react.default.createElement(EmojiContainer,{key:a.id,onClick:()=>{var a;return null===(a=g.current)||void 0===a?void 0:a.scrollToIndex({groupIndex:b})}},_react.default.createElement(o,{category:a}))))),_react.default.createElement(_EmojiPreview.EmojiPreview,{active:j,renderEmoji:d}))}