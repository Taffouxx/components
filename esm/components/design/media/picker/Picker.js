function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}import{observable}from"mobx";import React,{memo,useMemo,useRef,useState}from"react";import{GroupedVirtuoso}from"react-virtuoso";import styled from"styled-components";import useCloseHook from"../../../../lib/closeHook";import{Avatar,Column,InputBox}from"../../atoms";import{EmojiPreview}from"./EmojiPreview";var ROW_SIZE=8,Base=styled(Column).withConfig({displayName:"Base",componentId:"sc-1c6g74-0"})(["overflow:hidden;user-select:none;position:absolute;right:10px;bottom:10px;width:calc("," * 40px + 10px + 40px);height:420px;max-width:calc(100vw - 20px);max-height:calc(75vh);background:var(--background);border-radius:var(--border-radius);"],8),Controls=styled(Column).withConfig({displayName:"Controls",componentId:"sc-1c6g74-1"})(["padding:0.5em;"]),Parent=styled.div.withConfig({displayName:"Parent",componentId:"sc-1c6g74-2"})(["flex-grow:1;min-height:0;display:flex;flex-direction:row;"]),Groups=styled.div.withConfig({displayName:"Groups",componentId:"sc-1c6g74-3"})(["width:40px;overflow-y:scroll;scrollbar-width:none;background:var(--secondary-background);border-start-start-radius:var(--border-radius);&::-webkit-scrollbar{width:0px;}"]),EmojiContainer=styled.a.withConfig({displayName:"EmojiContainer",componentId:"sc-1c6g74-4"})(["display:grid;place-items:center;width:40px;height:40px;cursor:pointer;transition:0.1s ease all;border-radius:var(--border-radius);&:hover{background:var(--tertiary-background);}&:active{filter:brightness(0.9);}img{width:28px;height:28px;object-fit:contain;}"]),RowContainer=styled.div.withConfig({displayName:"RowContainer",componentId:"sc-1c6g74-5"})(["display:flex;flex-wrap:wrap;"]),CategoryBar=styled.div.withConfig({displayName:"CategoryBar",componentId:"sc-1c6g74-6"})(["display:flex;align-items:center;background:var(--background);"]),CategoryIcon=styled.div.withConfig({displayName:"CategoryIcon",componentId:"sc-1c6g74-7"})(["display:grid;place-items:center;width:40px;height:40px;user-select:none;pointer-events:none;filter:brightness(0.75);"]),CategoryName=styled.span.withConfig({displayName:"CategoryName",componentId:"sc-1c6g74-8"})(["width:100%;padding:0 0.2em;text-align:left;color:var(--foreground);filter:brightness(0.75);"]);export function Picker(a){var b=a.emojis,c=a.categories,d=a.renderEmoji,e=a.onSelect,f=a.onClose,g=useRef(null),h=useState(""),i=_slicedToArray(h,2),j=i[0],k=i[1],l=observable({emoji:null}),m=useMemo(function(){var a,d=j.trim().toLowerCase(),e=[],f=[],g=[],h=_createForOfIteratorHelper(c);try{for(h.s();!(a=h.n()).done;){var i,k=a.value,l=null!==(i=b[k.id])&&void 0!==i?i:[];if(!(d&&(l=l.filter(function(a){return a.name?a.name.includes(d):a.id.includes(d)}),0===l.length))){var m=function(a,b){for(var c=[],d=0;d<a.length;d+=b)c.push(a.slice(d,d+b));return c},n=m(l,ROW_SIZE);e.push.apply(e,_toConsumableArray(n)),f.push(k),g.push(n.length)}}}catch(a){h.e(a)}finally{h.f()}return{items:e,categoryCounts:g,activeCategories:f}},[j,c,b]),n=m.items,o=m.categoryCounts,p=m.activeCategories,q=useMemo(function(){return memo(function(a){var b=a.index;return React.createElement(React.Fragment,null,n[b].map(function(a){return React.createElement(EmojiContainer,{key:a.id,onClick:function onClick(b){null===e||void 0===e?void 0:e(a.id),b.shiftKey||(null===f||void 0===f?void 0:f())},onMouseOver:function onMouseOver(){return l.emoji=a}},React.createElement(d,{emoji:a.id}))}))})},[n,l,f,e,d]),r=useMemo(function(){return memo(function(a){var b=a.category;return React.createElement(CategoryIcon,null,b.emoji?React.createElement(EmojiContainer,null,React.createElement(d,{emoji:b.emoji})):React.createElement(Avatar,{size:24,fallback:b.name,src:b.iconURL}))})},[d]),s=useCloseHook(f);return React.createElement(Base,{gap:"0",ref:s},React.createElement(Controls,null,React.createElement(InputBox,{autoFocus:!0,value:j,onChange:function onChange(a){return k(a.currentTarget.value)},placeholder:"Type to search..."})),React.createElement(Parent,null,React.createElement(GroupedVirtuoso,{ref:g,style:{flexGrow:1,padding:"0 2px",overflowX:"hidden"},components:{Item:RowContainer},groupCounts:o,groupContent:function groupContent(a){var b=p[a];return React.createElement(CategoryBar,null,React.createElement(r,{category:b}),React.createElement(CategoryName,null,b.name))},itemContent:function itemContent(a){return React.createElement(q,{index:a})}}),React.createElement(Groups,null,p.map(function(a,b){return React.createElement(EmojiContainer,{key:a.id,onClick:function onClick(){var a;return null===(a=g.current)||void 0===a?void 0:a.scrollToIndex({groupIndex:b})}},React.createElement(r,{category:a}))}))),React.createElement(EmojiPreview,{active:l,renderEmoji:d}))}